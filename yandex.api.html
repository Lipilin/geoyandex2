<!DOCTYPE html>
<html>
<head>
    <title>API Yandex</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="https://api-maps.yandex.ru/2.1/?apikey=API-ключ вышего сервиса&lang=ru_RU"type="text/javascript"></script>
    <script src="https://yandex.st/jquery/2.2.3/jquery.min.js" type="text/javascript"></script>
    <style>
        #map {
            width: 100%; height: 100%; padding: 0; margin: 0;
        }
        html,body{
            width:400px;
            height:500px;
        }
    </style>
</head>
<body>
<select id = "selection"> 
    <optgroup label = "Россия">
    <option value="Moscow" id = "Moscow">Москва</option>
    <option value = "SPB" id= "SPB">Санкт-Петербург</option>
    </optgroup>
</select>
<div id="map"></div>
</body>
</html>
<script id="main" type="text/javascript">
ymaps.ready(function () {
    var value="Moscow";
    var Moscow_points=[];
    var SPB_points=[];
    all_points=new Map([
        ['Moscow',Moscow_points],
        ['SPB',SPB_points]
        ]);//Здесь хранятся точки различных городов
    var choose = document.querySelector('#selection');
choose.addEventListener("change", function() {//при изменении <select></select> срабатывает функция
    $(".menu").detach();
    value = choose.value;
    town_points = change_value();
    myMap = myMap.destroy(); //уничтожаем предыдущую карту
    choose_point();
    var zoomto = new zoom;
    zoomto.zoom_object();
    var coords_db = new Map([
        ['Moscow', [55.751574, 37.573856]],
        ['SPB', [ 59.9386, 30.3141]],
    ]);//сюда добавлять координаты новых городов
    var coords = coords_db.get(value);
    var points=all_points.get(value);
    //рисуем вторую,третью и т.д. карты
    myMap = new ymaps.Map('map', {
        center: [coords[0],coords[1] ], //координаты
        zoom: 9, //приближение карты
        controls:[]
    });
    //создаем новын маркеры
    for (var i=0; i<points.length;i++){
        myMap.geoObjects.add(points[i]);
    }
    myMap.controls.add(searchControl);

});

    //создание самой первой карта
    var myMap = new ymaps.Map('map', {
        center: [55.751574,37.573856 ], //координаты
        zoom: 9, //приближение карты
        controls:[] 
    });
    //здесь создаем все метки для карт
    Placemark1 = new ymaps.Placemark(myMap.getCenter(), {
        hintContent: 'Кремль',
        balloonContentHeader: "Кремль2",
        balloonContentBody:  '<img src="background.png" height="150" width="200">',
        balloonContentFooter: '<button id="Placemark1_path">Как добраться?</button>',
        hintContent: "Хинт метки"
    }, {
        iconLayout: 'default#image',
        iconImageHref: 'background.png', //ссылка на изображение компании(для маркера)
        iconImageSize: [30, 42],//размер картинки
        iconImageOffset: [-5, -38] //расположение точки относительно центра карты(т.к. в данном случае - mymap.getCenter())
    });
    Placemark2 = new ymaps.Placemark([55.661574, 37.573856], {
        hintContent: 'Добро пожаловать в Москву',
        balloonContentHeader: 'Кремль'
    }, {
        iconLayout: 'default#image',
        iconImageHref: 'background.png', //ссылка на изображение компании(для маркера)
        iconImageSize: [30, 42],//размер картинки //расположение точки относительно центра карты(т.к. в данном случае - mymap.getCenter())
    });
    Placemark4 = new ymaps.Placemark([ 59.9386, 30.3141],{ //даем координаты новой точки
        hintContent: 'название вашей компании',
        balloonContentHeader: 'Также название вашей компании'
    }, {
        iconLayout: 'default#image',//ти файла
        iconImageHref: 'background.png', //ссылка на изображение компании(для маркера)
        iconImageSize: [30, 42],//размер картинки
    });

    Moscow_points.push(Placemark1); //добавляем новую точку в коллекцию города, в который хотим их добавить(В данном случае Moscow_points - Москва, может быть SPB_points - Санкт Петербург, или другие города, созданные вами )
    Moscow_points.push(Placemark2);
    SPB_points.push(Placemark4);//добавляем новую точку в коллекцию города, в который хотим их добавить(В данном случае SPB_points - Санкт Петербург, может быть Moscow_points - Москва, или другие города, созданные вами )
    //добавляем метки на первую карту
    myMap.geoObjects.add(Placemark1); //добавляем на первую карту 
    myMap.geoObjects.add(Placemark2);
    function change_value(){
    if(value=="Moscow"){//по аналогии сбда добавляем новые города
            var town_points=Moscow_points;
            return town_points;
    }
    if(value=="SPB"){
            var town_points=SPB_points;
            return town_points;
     }     
    }
    town_points = change_value();
    function choose_point(){
        var menu = $('<ul class="menu"/>');
        for (var i=0;i<town_points.length;i+=1){
            var information = town_points[i].properties.get('balloonContentHeader')
            var menuItem = $('<li><a href="#"class="choosen" id="'+i+'">' + information + '</a></li>');
            menuItem.appendTo(menu);
        }
        menu.appendTo($('body'));
    }
    choose_point();
    class zoom{
        zoom_object(){
            var menu=document.querySelector(".menu");
            menu.addEventListener("click", function() {
            var target = event.target;
            target = target.id;
            if (!town_points[target].balloon.isOpen()) {
                myMap.panTo([town_points[target].geometry.getCoordinates()], {
                    delay: 0,
                    flying: true
                    }).then(function() {
                         myMap.setZoom(13);
                    });
                town_points[target].balloon.open();
            }else{
                myMap.setZoom(9);
                town_points[target].balloon.close();
            }
            return false;
    })
        }
    }
    var zoomto = new zoom;
    zoomto.zoom_object();
    var searchControl = new ymaps.control.SearchControl({ //создание поиска на карте
        options: {
            provider: 'yandex#search'
        }
    });
    myMap.controls.add(searchControl);
    //тут создаем функцию для кнопки "Как добраться?"для других по аналогии с первой кнопкой
    Placemark1.events.add('balloonopen', function (e) {
        var getPlacemark=document.querySelector("#Placemark1_path"); //при открытии Placemark1 получаем кнопку "Как добраться?"
        getPlacemark.addEventListener("click", function() {//при нажатии на эту кнопку запускаем событие
            Placemark1.properties.set('balloonContentBody', "На маршрутке");
            Placemark1.properties.set('balloonContentFooter', '<button id="Placemark1_path">Назад</button>'); //меняем парамерты baloonContentBody и baloonContentFooter
            var getPlacemark=document.querySelector("#Placemark1_path");//получаем кнопку "Назад" для того чтобы посетитель мог вернуться назад
                    getPlacemark.addEventListener("click", function() {//при нажатии вызываем функцию,которая вернет все назад
                                    Placemark1.properties.set('balloonContentBody','<img src="background.png" height="150" width="200">');
                                    Placemark1.properties.set('balloonContentFooter', '<button id="Placemark1_path">Как добраться?</button>');
                                    Placemark1.balloon.close();
                    })
        });
    });
});
</script>
